import React, {useContext, useEffect, useState} from "react";

import Layout from 'conteiners/layout';
import useFetch from 'hooks/useFetch'
import {addProductToBasket} from "utils";
import {CurrentBasketContext} from "contexts/currentBasket";
import useLocalStorage from "hooks/useLocalStorage";
import {getIds} from "utils";


/**
 * Страница Продукта
 */
const Product = props => {
    const apiUrl = `/rest/products/${props.match.params.id}`
    const [{response}, doFetch] = useFetch(apiUrl)
    const [product, setProduct] = useState({})
    const [currentBasketState, dispatch] = useContext(CurrentBasketContext)
    const [, setProd] = useLocalStorage('productsIds')
    const [elem1, setElem1] = useState(undefined)
    const [elem2, setElem2] = useState(undefined)
    const [elem3, setElem3] = useState(undefined)
    const [elem11, setElem11] = useState(undefined)
    const [elem22, setElem22] = useState(undefined)
    const [elem33, setElem33] = useState(undefined)

    useEffect(()=>{
        if(currentBasketState.length === 0){
            return
        }
        setProd(getIds(currentBasketState))
    }, [currentBasketState, setProd])

    useEffect(()=> {
        doFetch()
    }, [doFetch])

    useEffect(()=>{
        if(!response){
            return
        }
        setElem1(document.getElementById('desc1'));
        setElem2(document.getElementById('info1'));
        setElem3(document.getElementById('review1'));
        setElem11(document.getElementById('desc'));
        setElem22(document.getElementById('info'));
        setElem33(document.getElementById('review'));
        setProduct(response)
    }, [response])

    /*useEffect(()=>{

    }, [addProductToBasket])*/

    const getActive = id => {
        if(elem1 === undefined && elem2 === undefined && elem3 === undefined) {
            return
        }
        switch (id) {
           case 'desc1': {
              if(!elem1.classList.contains('active')){
                  elem1.classList.toggle('active')
                  elem11.classList.toggle('active')
              }
              if(elem2.classList.contains('active')){
                  elem2.classList.remove('active')
                  elem22.classList.remove('active')
              }
              if(elem3.classList.contains('active')){
                  elem3.classList.remove('active')
                  elem33.classList.remove('active')
              }
              break;
           }
           case 'info1': {
               if (elem1.classList.contains('active')) {
                   elem1.classList.remove('active')
                   elem11.classList.remove('active')
               }
               if (!elem2.classList.contains('active')) {
                   elem2.classList.toggle('active')
                   elem22.classList.toggle('active')
               }
               if (elem3.classList.contains('active')) {
                   elem3.classList.remove('active')
                   elem33.classList.remove('active')
               }
               break;
           }
           case 'review1': {
               if (elem1.classList.contains('active')) {
                   elem1.classList.remove('active')
                   elem11.classList.remove('active')
               }
               if (elem2.classList.contains('active')) {
                   elem2.classList.remove('active')
                   elem22.classList.remove('active')
               }
               if (!elem3.classList.contains('active')) {
                   elem3.classList.toggle('active')
                   elem33.classList.toggle('active')
               }
               break;
           }
            default:
                break
        }
    }
    const renderProduct = () => {
        return (
            <div>
                <br></br>
                <div className="col-xs-12 col-sm-5 col-md-6">
                     <div className="product-images">
                                    <div className="main-img js-product-slider">
                                        <a href="#" className="hover-images effect">
                                            <img src={product.image}
                                                 alt="photo"
                                                 className="img-reponsive"/>
                                        </a>
                                    </div>
                                </div>
                    <div className="multiple-img-list-ver2 js-click-product">
                        <div className="product-col">
                            <div className="img active">
                                <img src={product.image} alt="images" className="img-responsive"/>
                            </div>
                        </div>
                        <div className="product-col">
                            <div className="img">
                                <img src={product.image} alt="images" className="img-responsive"/>
                            </div>
                        </div>
                        <div className="product-col">
                            <div className="img">
                                <img src={product.image} alt="images" className="img-responsive"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div className="col-xs-12 col-sm-7 col-md-6">
                    <div className="single-product-info">
                        <div className="rating-star">
                            <div className="icon-rating"><span className="star star-5"></span>
                                <span className="star star-4"></span>
                                <span className="star star-3"></span>
                                <span className="star star-2"></span>
                                <span className="star star-1"></span>
                            </div>
                            <span className="review">(1 customer review)</span>
                        </div>
                        <h3 className="product-title"><a href="#">{product.name}</a></h3>
                        <div className="product-price">
                            <span className="old">{product.price} руб.</span>
                            <span>{product.price} руб.</span>
                        </div>
                        <p className="product-desc">{product.description}
                        </p>
                         <div className="action v2">
                                        <a className="link-ver1 add-cart"
                                        onClick={() => addProductToBasket(product, dispatch)}>Купить</a>
                                        <div className="clearfix"></div>
                         </div>
                    </div>
                </div>
            </div>

        )

    }

    return (
            <Layout>
                <div className="container">
                    <div className="single-product-detail product-bundle product-aff">
                        <div className="row">
                            {renderProduct()}
                        </div>
                    </div>
                    <div className="single-product-tab">
                        <ul className="nav nav-tabs text-center">
                            <li id='desc1' className='elements active' onClick={() => getActive('desc1')}>
                                <a data-toggle="pill" href="#desc" >Описание</a></li>

                            <li id='info1' className='elements' onClick={() => getActive('info1')}>
                                <a data-toggle="pill" href="#info" >Дополнительная информация</a></li>

                            <li id='review1' className='elements'  onClick={() => getActive('review1')}>
                                <a data-toggle="pill" href="#review">Отзывы</a></li>
                        </ul>
                        <div className="tab-content">
                            <div id="desc" className="tab-pane fade in active" >
                                <p className="p-center">Самая лучшая питьевая вода. Оптимальный выбор. Подходит для офисов и дома.
                                    Добывается из природных источников.</p>
                            </div>
                            <div id="info" className="tab-pane fade in">
                                <p className="p-center">ОАО «ЭРА», торговая марка «Кашинская». Добывается из источника № 12 санатория «Кашин».</p>
                            </div>
                            <div id="review" className="tab-pane fade in ">
                                <p className="p-center">Самая хорошая минералка, которую я пил. Наладился стул и соответственно настроение! </p>
                            </div>
                        </div>
                    </div>
                </div>


            </Layout>

        )
    }


export default Product;